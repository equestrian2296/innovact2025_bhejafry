<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß† Neurodiverse Learning Platform - ML Testing</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            background: #fafafa;
        }

        .test-section h2 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #34495e;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #3498db;
        }

        .btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .result-section {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin-top: 15px;
            max-height: 500px;
            overflow-y: auto;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
            font-style: italic;
        }

        .flashcard {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            position: relative;
        }

        .question {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .answer {
            color: #27ae60;
            font-style: italic;
        }

        .difficulty {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .difficulty.easy {
            background: #d4edda;
            color: #155724;
        }

        .difficulty.medium {
            background: #fff3cd;
            color: #856404;
        }

        .difficulty.hard {
            background: #f8d7da;
            color: #721c24;
        }

        .summary-point {
            background: #e8f5e8;
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            border-left: 4px solid #27ae60;
        }

        .mcq-option {
            background: white;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 12px;
            margin: 8px 0;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .mcq-option:hover {
            border-color: #3498db;
            background: #f8f9fa;
        }

        .mcq-option.correct {
            border-color: #27ae60;
            background: #d4edda;
        }

        .mcq-option.incorrect {
            border-color: #e74c3c;
            background: #f8d7da;
        }

        .status-bar {
            background: #2c3e50;
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: 600;
            border-radius: 0 0 15px 15px;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #e74c3c;
        }

        .success {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #27ae60;
        }

        .pdf-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .pdf-option {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .pdf-option:hover {
            border-color: #3498db;
            background: #e3f2fd;
        }

        .pdf-option.selected {
            border-color: #3498db;
            background: #e3f2fd;
            color: #2980b9;
        }

        .pdf-option h3 {
            margin-bottom: 8px;
            color: #2c3e50;
        }

        .pdf-option p {
            font-size: 12px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß† Neurodiverse Learning Platform</h1>
            <p>AI-Powered Personalized Learning for Neurodiverse Students</p>
        </div>

        <div class="main-content">
            <!-- System Status -->
            <div class="test-section">
                <h2>üîß System Status</h2>
                <button class="btn" onclick="checkSystemStatus()">Check Backend Status</button>
                <div id="systemStatus" class="result-section" style="display: none;"></div>
            </div>

            <!-- PDF Processing Options -->
            <div class="test-section">
                <h2>üìÑ PDF Processing Options</h2>
                <div class="pdf-options">
                    <div class="pdf-option" onclick="selectPDFMode('text_only')" id="text-only-option">
                        <h3>üìù Text-Only Processing</h3>
                        <p>Fast, simple text extraction from PDFs. Good for most documents.</p>
                    </div>
                    <div class="pdf-option" onclick="selectPDFMode('full_pdf')" id="full-pdf-option">
                        <h3>üîç Full PDF Processing</h3>
                        <p>Complete processing with OCR, images, and advanced features.</p>
                    </div>
                </div>
                <div id="pdfModeStatus" class="success" style="display: none;"></div>
            </div>

            <!-- Learning Profile Selection -->
            <div class="test-section">
                <h2>üë§ Learning Profile</h2>
                <div class="form-group">
                    <label for="learningProfile">Select Learning Profile:</label>
                    <select id="learningProfile">
                        <option value="ADHD">ADHD - Attention Deficit Hyperactivity Disorder</option>
                        <option value="DYSLEXIA">Dyslexia - Reading and Language Processing</option>
                        <option value="AUTISM">Autism - Structured Learning and Predictability</option>
                        <option value="DYSCALCULIA">Dyscalculia - Mathematical Processing</option>
                        <option value="DYSGRAPHIA">Dysgraphia - Writing and Expression</option>
                        <option value="NEUROTYPICAL">Neurotypical - Standard Learning</option>
                    </select>
                </div>
            </div>

            <!-- Text Input -->
            <div class="test-section">
                <h2>üìù Educational Content</h2>
                <div class="form-group">
                    <label for="contentText">Enter educational text to process:</label>
                    <textarea id="contentText" rows="6" placeholder="Enter educational content here... For example: Algebra is a branch of mathematics that deals with symbols and the rules for manipulating these symbols. In algebra, we use letters like x, y, z to represent unknown values. Variables are letters that represent numbers whose values we don't know or want to represent. Constants are numbers that have fixed values, like 2, 3, 7. Expressions are combinations of variables and constants, like 2x + 3."></textarea>
                </div>
            </div>

            <!-- Test Buttons -->
            <div class="test-section">
                <h2>üß™ Test ML Services</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <button class="btn" onclick="testLearningItems()">Generate Learning Items</button>
                    <button class="btn" onclick="testTextSimplification()">Simplify Text</button>
                    <button class="btn" onclick="testMicroLessons()">Create Micro-Lessons</button>
                    <button class="btn" onclick="testTTS()">Generate Audio</button>
                    <button class="btn" onclick="testMathParsing()">Parse Math</button>
                    <button class="btn" onclick="testCompletePipeline()">Complete Pipeline</button>
                </div>
            </div>

            <!-- Results -->
            <div class="test-section">
                <h2>üìä Results</h2>
                <div id="results" class="result-section">
                    <p>Click any test button above to see results here.</p>
                </div>
            </div>
        </div>

        <div class="status-bar">
            <span id="statusText">Ready to test ML capabilities</span>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000';
        let currentResults = {};
        let currentPDFMode = 'text_only';

        function updateStatus(message, type = 'info') {
            document.getElementById('statusText').textContent = message;
        }

        function showLoading(elementId) {
            const element = document.getElementById(elementId);
            element.innerHTML = '<div class="loading">Processing...</div>';
            element.style.display = 'block';
        }

        function showError(message) {
            const results = document.getElementById('results');
            results.innerHTML = `<div class="error">‚ùå Error: ${message}</div>`;
            results.style.display = 'block';
        }

        function showSuccess(message) {
            const results = document.getElementById('results');
            results.innerHTML = `<div class="success">‚úÖ ${message}</div>`;
            results.style.display = 'block';
        }

        function selectPDFMode(mode) {
            currentPDFMode = mode;
            
            // Update UI
            document.querySelectorAll('.pdf-option').forEach(opt => opt.classList.remove('selected'));
            if (mode === 'text_only') {
                document.getElementById('text-only-option').classList.add('selected');
            } else {
                document.getElementById('full-pdf-option').classList.add('selected');
            }
            
            // Update backend
            makeRequest('/set-pdf-mode', { mode: mode })
                .then(() => {
                    const statusDiv = document.getElementById('pdfModeStatus');
                    statusDiv.innerHTML = `‚úÖ PDF processing mode set to: ${mode}`;
                    statusDiv.style.display = 'block';
                    setTimeout(() => statusDiv.style.display = 'none', 3000);
                })
                .catch(error => {
                    console.error('Failed to set PDF mode:', error);
                });
        }

        async function makeRequest(endpoint, data = null) {
            try {
                updateStatus('Making request...');
                const options = {
                    method: data ? 'POST' : 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    mode: 'cors',
                    credentials: 'omit'
                };

                if (data) {
                    options.body = JSON.stringify(data);
                }

                const response = await fetch(`${API_BASE}${endpoint}`, options);
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(errorData.detail || `HTTP ${response.status}: ${response.statusText}`);
                }

                return await response.json();
            } catch (error) {
                console.error('Request failed:', error);
                if (error.message.includes('Failed to fetch')) {
                    throw new Error('Backend server is not running. Please start the backend first.');
                }
                throw error;
            }
        }

        async function checkSystemStatus() {
            try {
                updateStatus('Checking system status...');
                showLoading('systemStatus');

                const status = await makeRequest('/');
                const geminiStats = await makeRequest('/gemini-stats');

                const statusHtml = `
                    <h3>‚úÖ Backend Status</h3>
                    <p><strong>API:</strong> ${status.message}</p>
                    <p><strong>Gemini Available:</strong> ${geminiStats.gemini_available ? '‚úÖ Yes' : '‚ùå No'}</p>
                    <p><strong>Daily Requests Used:</strong> ${geminiStats.daily_requests_used}/${geminiStats.daily_requests_remaining + geminiStats.daily_requests_used}</p>
                    <p><strong>Requests This Minute:</strong> ${geminiStats.requests_last_minute}/15</p>
                    <p><strong>Current PDF Mode:</strong> ${currentPDFMode}</p>
                `;

                document.getElementById('systemStatus').innerHTML = statusHtml;
                document.getElementById('systemStatus').style.display = 'block';
                updateStatus('System status checked successfully');
            } catch (error) {
                showError(`Failed to check system status: ${error.message}`);
                updateStatus('System status check failed');
            }
        }

        async function testLearningItems() {
            try {
                const text = document.getElementById('contentText').value;
                const profile = document.getElementById('learningProfile').value;

                if (!text.trim()) {
                    showError('Please enter some educational content first');
                    return;
                }

                updateStatus('Generating learning items...');
                showLoading('results');

                const result = await makeRequest('/generate-learning-items', {
                    chunk_text: text,
                    learning_profile: profile
                });

                const resultsHtml = `
                    <h3>üéì Learning Items Generated</h3>
                    <p><strong>Profile:</strong> ${profile}</p>
                    <p><strong>Estimated Study Time:</strong> ${result.estimated_study_time_minutes} minutes</p>
                    
                    <h4>üìö Flashcards (${result.flashcards.length})</h4>
                    ${result.flashcards.map(card => `
                        <div class="flashcard">
                            <div class="question">‚ùì ${card.question}</div>
                            <div class="answer">üí° ${card.answer}</div>
                            <span class="difficulty ${card.difficulty}">${card.difficulty.toUpperCase()}</span>
                        </div>
                    `).join('')}
                    
                    <h4>üìù Summary (${result.summary.length} points)</h4>
                    ${result.summary.map(point => `
                        <div class="summary-point">‚Ä¢ ${point}</div>
                    `).join('')}
                    
                    <h4>‚ùì Multiple Choice Question</h4>
                    <div class="mcq-option">
                        <strong>${result.mcq.question}</strong>
                    </div>
                    ${result.mcq.options.map((option, index) => `
                        <div class="mcq-option" onclick="selectMCQOption(this, '${option}', '${result.mcq.correct_answer}')">
                            ${String.fromCharCode(65 + index)}. ${option}
                        </div>
                    `).join('')}
                `;

                document.getElementById('results').innerHTML = resultsHtml;
                document.getElementById('results').style.display = 'block';
                updateStatus('Learning items generated successfully');
            } catch (error) {
                showError(`Failed to generate learning items: ${error.message}`);
                updateStatus('Learning items generation failed');
            }
        }

        function selectMCQOption(element, selected, correct) {
            // Remove previous selections
            document.querySelectorAll('.mcq-option').forEach(opt => {
                opt.classList.remove('correct', 'incorrect');
            });

            // Add selection styling
            if (selected === correct) {
                element.classList.add('correct');
            } else {
                element.classList.add('incorrect');
                // Also highlight the correct answer
                document.querySelectorAll('.mcq-option').forEach(opt => {
                    if (opt.textContent.includes(correct)) {
                        opt.classList.add('correct');
                    }
                });
            }
        }

        async function testTextSimplification() {
            try {
                const text = document.getElementById('contentText').value;

                if (!text.trim()) {
                    showError('Please enter some educational content first');
                    return;
                }

                updateStatus('Simplifying text...');
                showLoading('results');

                const result = await makeRequest('/simplify-text', {
                    original_text: text,
                    target_grade_level: 6
                });

                const resultsHtml = `
                    <h3>üìñ Text Simplification</h3>
                    <p><strong>Readability Score:</strong> ${result.readability_score}</p>
                    <p><strong>Word Reduction:</strong> ${result.word_count_reduction} words</p>
                    
                    <h4>üìù Original Text</h4>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 10px 0;">
                        ${result.original}
                    </div>
                    
                    <h4>‚ú® Simplified Text</h4>
                    <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; margin: 10px 0;">
                        ${result.simplified}
                    </div>
                `;

                document.getElementById('results').innerHTML = resultsHtml;
                document.getElementById('results').style.display = 'block';
                updateStatus('Text simplified successfully');
            } catch (error) {
                showError(`Failed to simplify text: ${error.message}`);
                updateStatus('Text simplification failed');
            }
        }

        async function testMicroLessons() {
            try {
                const text = document.getElementById('contentText').value;

                if (!text.trim()) {
                    showError('Please enter some educational content first');
                    return;
                }

                updateStatus('Creating micro-lessons...');
                showLoading('results');

                const result = await makeRequest('/generate-micro-lessons', {
                    topic_text: text,
                    max_items: 5
                });

                const resultsHtml = `
                    <h3>‚ö° Micro-Lessons Created</h3>
                    <p><strong>Total Items:</strong> ${result.micro_lessons.length}</p>
                    <p><strong>Estimated Time:</strong> ${result.total_estimated_time_minutes} minutes</p>
                    
                    <h4>üìö Micro-Lessons</h4>
                    ${result.micro_lessons.map((lesson, index) => `
                        <div class="flashcard">
                            <div class="question">‚ùì ${lesson.question}</div>
                            <div class="answer">üí° ${lesson.answer}</div>
                            <span class="difficulty easy">MICRO</span>
                        </div>
                    `).join('')}
                `;

                document.getElementById('results').innerHTML = resultsHtml;
                document.getElementById('results').style.display = 'block';
                updateStatus('Micro-lessons created successfully');
            } catch (error) {
                showError(`Failed to create micro-lessons: ${error.message}`);
                updateStatus('Micro-lessons creation failed');
            }
        }

        async function testTTS() {
            try {
                const text = document.getElementById('contentText').value;
                const profile = document.getElementById('learningProfile').value;

                if (!text.trim()) {
                    showError('Please enter some educational content first');
                    return;
                }

                updateStatus('Generating audio...');
                showLoading('results');

                const result = await makeRequest('/generate-audio', {
                    text: text.substring(0, 200), // Limit text length
                    voice_type: "FEMALE",
                    learning_profile: profile
                });

                const resultsHtml = `
                    <h3>üîä Audio Generated</h3>
                    <p><strong>Audio File:</strong> ${result.audio_file_path}</p>
                    <p><strong>Duration:</strong> ${result.duration_seconds} seconds</p>
                    <p><strong>Text Length:</strong> ${result.text_length} characters</p>
                    
                    <div class="success">
                        ‚úÖ Audio file generated successfully! Check the backend audio_files directory.
                    </div>
                `;

                document.getElementById('results').innerHTML = resultsHtml;
                document.getElementById('results').style.display = 'block';
                updateStatus('Audio generated successfully');
            } catch (error) {
                showError(`Failed to generate audio: ${error.message}`);
                updateStatus('Audio generation failed');
            }
        }

        async function testMathParsing() {
            try {
                updateStatus('Parsing math expressions...');
                showLoading('results');

                const result = await makeRequest('/parse-math', {
                    math_expression: "2x + 3 = 7",
                    explanation_level: "BASIC"
                });

                const resultsHtml = `
                    <h3>üßÆ Math Parsing Results</h3>
                    <p><strong>Expression:</strong> ${result.problem}</p>
                    <p><strong>Final Answer:</strong> ${result.final_answer}</p>
                    
                    <h4>üìù Step-by-Step Solution</h4>
                    ${result.steps.map((step, index) => `
                        <div class="summary-point">
                            <strong>Step ${index + 1}:</strong> ${step.explanation}
                        </div>
                    `).join('')}
                `;

                document.getElementById('results').innerHTML = resultsHtml;
                document.getElementById('results').style.display = 'block';
                updateStatus('Math parsing completed successfully');
            } catch (error) {
                showError(`Failed to parse math: ${error.message}`);
                updateStatus('Math parsing failed');
            }
        }

        async function testCompletePipeline() {
            try {
                const text = document.getElementById('contentText').value;
                const profile = document.getElementById('learningProfile').value;

                if (!text.trim()) {
                    showError('Please enter some educational content first');
                    return;
                }

                updateStatus('Running complete pipeline...');
                showLoading('results');

                const result = await makeRequest('/process-complete', {
                    content: text,
                    learning_profile: profile,
                    input_type: "text"
                });

                const resultsHtml = `
                    <h3>üöÄ Complete Pipeline Results</h3>
                    <p><strong>Profile:</strong> ${profile}</p>
                    
                    <h4>üìÑ Extracted Data</h4>
                    <p><strong>Heading:</strong> ${result.extracted_data.heading}</p>
                    <p><strong>Confidence:</strong> ${result.extracted_data.confidence_score}</p>
                    <p><strong>Paragraphs:</strong> ${result.extracted_data.paragraphs.length}</p>
                    
                    <h4>üìö Topics Found</h4>
                    ${result.topics.topics.map(topic => `
                        <div class="summary-point">
                            <strong>${topic.topic}:</strong> ${topic.chunks.length} chunks
                        </div>
                    `).join('')}
                    
                    <h4>üéì Learning Items</h4>
                    <p><strong>Flashcards:</strong> ${result.learning_items.flashcards.length}</p>
                    <p><strong>Summary Points:</strong> ${result.learning_items.summary.length}</p>
                    
                    <h4>üìñ Simplified Text</h4>
                    <div style="background: #e8f5e8; padding: 10px; border-radius: 5px; margin: 5px 0;">
                        ${result.simplified_text.simplified.substring(0, 200)}...
                    </div>
                    
                    <h4>‚ö° Micro-Lessons</h4>
                    <p><strong>Created:</strong> ${result.micro_lessons.micro_lessons.length} micro-lessons</p>
                    
                    <h4>üó∫Ô∏è Learning Roadmap</h4>
                    <p><strong>Weeks:</strong> ${result.roadmap.roadmap.length}</p>
                `;

                document.getElementById('results').innerHTML = resultsHtml;
                document.getElementById('results').style.display = 'block';
                updateStatus('Complete pipeline executed successfully');
            } catch (error) {
                showError(`Failed to run complete pipeline: ${error.message}`);
                updateStatus('Complete pipeline failed');
            }
        }

        // Initialize PDF mode selection
        document.addEventListener('DOMContentLoaded', function() {
            selectPDFMode('text_only');
        });
    </script>
</body>
</html>
